files:
  /home/ec2-user/setCredential.sh:
    mode: "000755"
    owner: webapp
    group: webapp
    content: |
      echo {\"type\": \"service_account\", \"project_id\": \"cultivated-cove-320001\",  \"private_key_id\": \"$CAPTCHA_KEY_ID\",     \"private_key\": \"$CAPTCHA_PEM\", \"client_email\": \"$CAPTCHA_EMAIL\",  \"client_id\": \"115405318409515778219\",     \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",  \"token_uri\": \"https://oauth2.googleapis.com/token\",     \"auth_provider_x509_cert_url\": \"https://www.googleapis.com/oauth2/v1/certs\", \"client_x509_cert_url\":\" $CAPTCHA_X509\" } >> /home/ec2-user/credentials.json
      

container_commands:
  00_update_yum:
    command: "sudo yum update -y --skip-broken"
  01_enable_agent:
    command: "sudo elastic-agent enroll --url=${FLEETURL} --enrollment-token=${FLEETTOKEN} -f \
    && sudo systemctl enable elastic-agent \
    && sudo systemctl start elastic-agent"
    ignoreErrors: true
